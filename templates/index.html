<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Car Price Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  </head>
  <body>
    <div class="container d-flex justify-content-center align-items-center min-vh-100">
        <div class="card shadow glass-card p-4">
            <div class="card-header text-center border-0 bg-transparent">
                <h1 class="fw-bold text-gradient">üöó Car Price Predictor</h1>
                <p class="text-muted" style="color:white">Get instant predictions based on car details</p>
            </div>

            <div class="card-body">
                <form method="post" action="#" accept-charset="utf-8">
                    <!-- Company -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Select Company</label>
                        <select class="form-select" id="company" name="company" required 
                                onChange="load_car_models(this.id, 'car_model')">
                            {% for company in companies %}
                                <option value="{{ company }}">{{ company }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Model -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Select Model</label>
                        <select class="form-select" id="car_model" name="car_model" required></select>
                    </div>

                    <!-- Year -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Year of Purchase</label>
                        <select class="form-select" id="year" name="year" required>
                            {% for year in years %}
                                <option value="{{ year }}">{{ year }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Fuel Type -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Fuel Type</label>
                        <select class="form-select" id="fuel_type" name="fuel_type" required>
                            {% for fuel_type in fuel_types %}
                                <option value="{{ fuel_type }}">{{ fuel_type }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- KM Driven -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Kilometers Driven</label>
                        <input type="number" class="form-control" id="kilo_driven" 
                               name="kilo_driven" placeholder="Enter km travelled" required>
                    </div>

                    <!-- Predict Button -->
                    <button class="btn btn-gradient w-100 mt-3" onclick="send_data()">Predict</button>
                </form>

                <!-- Prediction Result -->
                <div class="text-center mt-4">
                    <h3 class="result"><span id="prediction"></span></h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
       function load_car_models(company_id, car_model_id) {
          var company = document.getElementById(company_id).value;
          var car_model = document.getElementById(car_model_id);
          car_model.innerHTML = "";
          {% for company in companies %}
              if (company === "{{ company }}") {
                  {% for model in car_models %}
                      {% if company in model %}
                          var newOption = document.createElement("option");
                          newOption.value = "{{ model }}";
                          newOption.innerHTML = "{{ model }}";
                          car_model.appendChild(newOption);
                      {% endif %}
                  {% endfor %}
              }
          {% endfor %}
       }

       function form_handler(event){ event.preventDefault(); }

       function send_data(){
          document.querySelector('form').addEventListener('submit', form_handler);
          var fd = new FormData(document.querySelector('form'));
          var xhr = new XMLHttpRequest();
          xhr.open('POST', '/predict', true);
          document.getElementById('prediction').innerHTML = "‚è≥ Predicting...";
          xhr.onreadystatechange = function(){
              if(xhr.readyState == XMLHttpRequest.DONE){
                  document.getElementById("prediction").innerHTML = 
                      "üí∞ Predicted Price: <b>‚Çπ " + xhr.responseText + "</b>";
              }
          }
          xhr.send(fd);
       }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
